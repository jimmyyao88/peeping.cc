!function(){"use strict";var a=!0;angular.module("app").controller("DialogCtrl",["$scope","stBlurredDialog","$http","$localStorage","$rootScope",function(a,t,o,e,r){a.dialogData=t.getDialogData(),a.toggleLog=function(){$("form").animate({height:"toggle",opacity:"toggle"},"slow")},a.register=function(){var t={nickname:a.registerName,email:a.registerEmail,password:a.registerPassword};o.post("/signup",{user:t}).success(function(t){e.user=t.user,r.user=e.user,a.close()}).error(function(a){console.log("error",a),alert("invalid access")})},a.login=function(){var t={email:a.signinEmail,password:a.signinPassword};o.post("/signin",{user:t}).success(function(t){e.user=t.user,r.user=e.user,a.close()}).error(function(a){console.log("error",a),alert("invalid access")})}}]),angular.module("app").directive("firstClick",["$rootScope",function(a){return{restrict:"EA",link:function(t,o,e){o.on("click",function(){a.firstClick=!1,a.$digest()})}}}]),angular.module("app").controller("rootCtrl",["$rootScope","$scope","$location","$localStorage","stBlurredDialog","$state",function(a,t,o,e,r,n){a.firstClick=!0,a.closeMenu=function(){$("#hamburger").prop("checked",!1)},t.isActive=function(a){return"/trending"==a&&"/"===o.path()?!0:o.path().substr(-a.length,a.length)===a},t.search=function(){o.path("/charts/search").search({query:this.searchTerm}),a.closeMenu()},t.openModal=function(){r.open("/resources/sc/html/dialogTemplate.html",{msg:"Hello from the controller!"})},t.logout=function(){e.$reset(),a.user=!1},a.$on("$stateChangeSuccess",function(t,o,e,r,n){a.previousState=r.name,a.currentState=o.name}),a.back=function(){n.go(a.previousState)}}]),angular.module("app").controller("DetailCtrl",["$scope","$state","$http","$rootScope",function(a,t,o,e){o.get("/track/"+t.params.id).success(function(t){e.isLoaded=!0,console.log("data",t),t.artwork_url?t.artwork_url=t.artwork_url.replace(/large.jpg/,"t500x500.jpg"):t.artwork_url="/images/sc.jpg",a.song=t,a.show=!0}).then(function(){return o.get("/tracks/related/"+t.params.id)}).then(function(t){angular.forEach(t.data,function(a,o){t.data[o].artwork_url||(t.data[o].artwork_url="/images/sc.jpg")}),a.relatedSongs=t.data}),a.showDesc=!1,a.toggleStatus="展开",a.toggleDesc=function(){a.showDesc?($(".detail-description-container").css("height","40px"),a.showDesc=!1,a.toggleStatus="展开"):($(".detail-description-container").css("height","auto"),a.showDesc=!0,a.toggleStatus="折叠")}}]),angular.module("app").controller("SearchCtrl",["$scope","$rootScope","$state","$http",function(a,t,o,e){a.page=0,a.haveMore=!0,a.songs=[],a.load=function(){a.loading=!0;var r=o.params;r.query.length>0?e.get("/tracks/search?query="+r.query).then(function(o){t.isLoaded=!0,angular.forEach(o.data,function(a,t){o.data[t].artwork_url?o.data[t].artwork_url=o.data[t].artwork_url.replace(/large.jpg/,"t500x500.jpg"):o.data[t].artwork_url="/images/sc.jpg"}),angular.forEach(o.data,function(t,o){a.songs.push(t)}),a.page++,a.loading=!1,o.data.length>=10?a.haveMore=!0:a.haveMore=!1},function(a){}):(a.loading=!1,a.haveMore=!1)}}]),angular.module("app").controller("ProfileCtrl",["$scope","$state","$http","$rootScope",function(a,t,o,e){o.get("/profile/"+t.params.id).then(function(r){return e.isLoaded=!0,a.show=!0,r.data.avatar_url&&(r.data.avatar_url=r.data.avatar_url.replace(/large.jpg/,"t500x500.jpg")),a.profile=r.data,o.get("/profile/"+t.params.id+"/tracks")}).then(function(t){angular.forEach(t.data,function(a,o){t.data[o].artwork_url?t.data[o].artwork_url=t.data[o].artwork_url.replace(/large.jpg/,"t500x500.jpg"):t.data[o].artwork_url="/images/sc.jpg"}),a.songs=t.data}),a.showDesc=!1,a.toggleStatus="展开",a.toggleDesc=function(){a.showDesc?($(".detail-description-container").css("height","40px"),a.showDesc=!1,a.toggleStatus="展开"):($(".detail-description-container").css("height","auto"),a.showDesc=!0,a.toggleStatus="折叠")}}]),angular.module("app").controller("Recommend",["$scope","$http","$localStorage","$rootScope","$state",function(a,t,o,e,r){a.haveMore=!0,e.show=!0,a.songs=[],e.rootShow=!0,a.page=0,e.user?e.user.favorites.length?(a.page=0,a.load=function(){a.loading=!0;var e=o.user.favorites.slice(3*a.page,3*a.page+3);console.log(e),e.length>0?t.post("/tracks/recommend",{favorites:e}).then(function(t){angular.forEach(t.data,function(a,o){t.data[o].artwork_url&&(t.data[o].artwork_url=t.data[o].artwork_url.replace(/large.jpg/,"t500x500.jpg"))}),angular.forEach(t.data,function(t,o){a.songs.push(t)}),a.page++,a.loading=!1,t.data.length>=30?a.haveMore=!0:a.haveMore=!1}):(a.loading=!1,a.haveMore=!1)}):(a.showAlert=!0,a.alert="你需要收藏更多的歌曲,来获得peeping给你的推荐"):r.go("index.trending")}]),angular.module("app").controller("Project",["$rootScope","$scope","dataFactory","$location","$stateParams","$state","$http","stBlurredDialog","$q","$localStorage",function(t,o,e,r,n,s,c,i,l,u){function g(){if(o.loading=!0,r.path().indexOf("favorites")>-1){if(!t.user)return void s.go("index.trending");if(!t.user.favorites.length)return void s.go("index.trending")}r.path();e.getAllData(r.path()+"?page="+o.page).success(function(a){if(t.isLoaded=!0,r.path().indexOf("favorites")>-1){var e=[];angular.forEach(a,function(a,t){var o=c.get("/track/"+a).then(function(a){return a.data});e.push(o)}),l.all(e).then(function(a){var t={};t.favorited="",t.success=!1,t.user=null,t.songs=[],a.forEach(function(a,o){a.url="/play?id="+a.id,t.songs.push(a)}),o.bindData(t)})}else o.bindData(a);o.loading=!1}).error(function(a){o.loading=!1,o.status="Unable to load data: "+a.message})}o.songs=[],o.page=0,t.show=!0,o.haveMore=!0,a?a=!1:($(".music-nav").find("li").removeClass("is-active"),a=!1),o.load=function(){g()};o.favorite=function(a,o){t.user&&(console.log("id",a),c.post("/favorite/save",{id:a},{headers:{access_token:t.user.token}}).success(function(a){console.log("response",a)}).error(function(a){console.log("error",a)}))},o.loadMore=function(){n.position=o.tracks.length,e.getAllData(r.path(),n).success(function(a){console.log("loadmore",a);for(var t=0;t<a.tracks.length;t++)o.tracks.push(a.tracks[t])})},o.isActive=function(a){return console.log("path",a),"/charts/trending"==a&&"/"===r.path()?!0:r.path().substr(0,a.length)===a},o.bindData=function(a){r.path().indexOf("/track/")>-1&&(o.hideButtons=!0),o.show=!0,o.searchTerm="",angular.forEach(a.songs,function(t,o){a.songs[o].artwork_url?a.songs[o].artwork_url=a.songs[o].artwork_url.replace(/large.jpg/,"t500x500.jpg"):a.songs[o].artwork_url="/images/sc.jpg"}),angular.forEach(a.songs,function(a,t){o.songs.push(a)}),"undefined"==typeof t.header&&(t.header="Rising.fm | New Music Discovery"),o.page++,o.$on("ngRepeatFinished",function(a){t.rootShow=!0})}}])}();